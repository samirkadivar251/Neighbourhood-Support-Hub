@model List<NSH.Models.RequestModel>

@{
    ViewBag.Title = "Requests";
    int? loggedInUserID = Session["UserID"] != null ? Convert.ToInt32(Session["UserID"]) : (int?)null;
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

<style>
    body {
        background: linear-gradient(135deg, #f8f9fa, #e0f7fa);
    }

    .card {
        border-radius: 1rem;
        transition: transform 0.3s, box-shadow 0.3s;
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }

    .badge-status {
        padding: 0.5em 0.8em;
        font-size: 0.85rem;
        border-radius: 1rem;
    }

    .card-footer .btn {
        border-radius: 20px;
    }
</style>

<div class="container my-5">
    <h2 class="text-center text-white bg-primary py-3 rounded shadow-sm">
        <i class="bi bi-person-lines-fill me-2"></i> Requests for Assistance
    </h2>

    <form method="get" action="@Url.Action("Index")" class="row g-3 align-items-center justify-content-center my-4">
        <div class="col-sm-5 col-md-4">
            <input type="text" name="searchQuery" value="@Request.QueryString["searchQuery"]"
                   class="form-control form-control-lg" placeholder="🔍 Search title or category...">
        </div>
        <div class="col-sm-4 col-md-3">
            <select name="statusFilter" class="form-select form-select-lg">
                <option value="">All Statuses</option>
                <option value="Pending" @(Request.QueryString["statusFilter"] == "Pending" ? "selected" : "")>Pending</option>
                <option value="Accepted" @(Request.QueryString["statusFilter"] == "Accepted" ? "selected" : "")>Accepted</option>
                <option value="Completed" @(Request.QueryString["statusFilter"] == "Completed" ? "selected" : "")>Completed</option>
            </select>
        </div>
        <div class="col-sm-3 col-md-2">
            <button type="submit" class="btn btn-lg btn-success w-100">
                <i class="bi bi-search me-1"></i> Search
            </button>
        </div>
    </form>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        @foreach (var request in Model)
        {
            var bgColor = request.Status == "Pending" ? "bg-warning bg-opacity-10"
                        : request.Status == "In Progress" ? "bg-info bg-opacity-10"
                        : "bg-success bg-opacity-10";

            var badgeClass = request.Status == "Pending" ? "bg-warning text-dark"
                          : request.Status == "In Progress" ? "bg-info text-dark"
                          : "bg-success";

            <div class="col">
                <div class="card h-100 border-0 shadow-lg @bgColor">
                    <div class="card-body">
                        <h5 class="card-title text-primary fw-bold">
                            <i class="bi bi-chat-left-dots-fill me-2"></i>@request.Title
                        </h5>
                        <h6 class="card-subtitle mb-2 text-muted">
                            <i class="bi bi-tags me-1"></i> @request.Category
                        </h6>
                        <p class="card-text mt-2">@request.Description</p>
                        <p class="mb-1"><strong><i class="bi bi-phone-fill me-1"></i>Contact:</strong> @request.Contact</p>
                        <p>
                            <strong>Status:</strong>
                            <span class="badge badge-status @badgeClass">@request.Status</span>
                        </p>
                        <p class="text-muted small mt-3">
                            <i class="bi bi-calendar-event me-1"></i> Created on @request.CreatedAt.ToString("dd MMM yyyy hh:mm tt")
                        </p>
                    </div>
                    <div class="card-footer bg-transparent border-0 d-flex justify-content-between">
                        @if (loggedInUserID != null && request.UserID == loggedInUserID)
                        {
                            <div>
                                <a href="@Url.Action("Edit", "Requests", new { id = request.RequestID })" class="btn btn-sm btn-outline-primary me-2">
                                    <i class="bi bi-pencil-fill"></i> Edit
                                </a>
                                <a href="@Url.Action("Delete", "Requests", new { id = request.RequestID })"
                                   class="btn btn-sm btn-outline-danger"
                                   onclick="return confirm('Are you sure you want to delete this request?');">
                                    <i class="bi bi-trash-fill"></i> Delete
                                </a>
                            </div>
                        }
                        else if (loggedInUserID != null && request.Status == "Pending")
                        {
                            <form action="@Url.Action("AcceptRequest", "Requests")" method="post" class="d-inline">
                                <input type="hidden" name="requestId" value="@request.RequestID" />
                                <button type="submit" class="btn btn-sm btn-outline-success">
                                    <i class="bi bi-check-circle-fill"></i> Accept
                                </button>
                            </form>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</div>
