@using NSH.Models
@model List<RequestModel>

@{
    ViewBag.Title = "User Dashboard";
    var createdRequests = ViewBag.CreatedRequests as List<RequestModel> ?? new List<RequestModel>();
    var acceptedRequests = ViewBag.AcceptedRequests as List<RequestModel> ?? new List<RequestModel>();
}

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #f8f9fa;
    }

    .dashboard-container {
        max-width: 1200px;
        margin: auto;
    }

    .dashboard-title {
        font-size: 28px;
        font-weight: 700;
        color: #333;
    }

    .card {
        border-radius: 12px;
        transition: 0.3s ease-in-out;
        overflow: hidden;
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
        }

    .badge {
        font-size: 14px;
        padding: 8px 12px;
        border-radius: 8px;
    }
</style>

<div class="container mt-4 dashboard-container">
    <div class="alert alert-primary text-center">
        <h2 class="dashboard-title">Welcome, @ViewBag.UserName! 👋</h2>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
    }

    <div class="row">
        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-success text-white">
                    <h4><i class="bi bi-pencil-square"></i> Your Created Requests</h4>
                </div>
                <div class="card-body">
                    @if (createdRequests.Any())
                    {
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var request in createdRequests)
                                {
                                    <tr>
                                        <td>@request.Title</td>
                                        <td>@request.Description</td>
                                        <td>
                                            <span class="badge @(request.Status.ToLower() == "pending" ? "bg-warning" : "bg-success")">
                                                @request.Status
                                            </span>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <p class="text-muted">No requests created yet.</p>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-info text-white">
                    <h4><i class="bi bi-check-circle"></i> Requests You Accepted</h4>
                </div>
                <div class="card-body">
                    @if (acceptedRequests.Any())
                    {
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Title</th>
                                    <th>Description</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var request in acceptedRequests)
                                {
                                    <tr>
                                        <td>@request.Title</td>
                                        <td>@request.Description</td>
                                        <td>
                                            <span class="badge @(request.Status.ToLower() == "pending" ? "bg-warning" : "bg-success")">
                                                @request.Status
                                            </span>
                                        </td>
                                        <td>
                                            @if (request.Status.ToLower() == "accepted")
                                            {
                                                <form action="@Url.Action("MarkAsCompleted", "Users")" method="post">
                                                    <input type="hidden" name="requestId" value="@request.RequestID" />
                                                    <button type="submit" class="btn btn-success">Mark as Completed</button>
                                                </form>



                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    }
                    else
                    {
                        <p class="text-muted">No accepted requests yet.</p>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
